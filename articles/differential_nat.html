<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Advanced options • safir</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Advanced options">
<meta property="og:description" content="safir">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">safir</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.5.5</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/antibody_efficacy.html">Modeling of antibody titre and immunity</a>
    </li>
    <li>
      <a href="../articles/compare_nimue.html">Nimue Validation Run</a>
    </li>
    <li>
      <a href="../articles/compare_squire.html">Squire Validation Run</a>
    </li>
    <li>
      <a href="../articles/differential_nat.html">Advanced options</a>
    </li>
    <li>
      <a href="../articles/natural_immunity.html">Natural Immunity</a>
    </li>
    <li>
      <a href="../articles/vaccine_notypes.html">Vaccine model with multiple doses</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/mrc-ide/safir/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Advanced options</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/mrc-ide/safir/blob/HEAD/vignettes/differential_nat.Rmd" class="external-link"><code>vignettes/differential_nat.Rmd</code></a></small>
      <div class="hidden name"><code>differential_nat.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/mrc-ide/safir" class="external-link">safir</a></span><span class="op">)</span></code></pre></div>
<div class="section level2">
<h2 id="differential-modeling-of-infection-and-vaccine-derived-nats">Differential modeling of infection and vaccine derived NATs<a class="anchor" aria-label="anchor" href="#differential-modeling-of-infection-and-vaccine-derived-nats"></a>
</h2>
<p><strong>safir</strong> allows differential modeling of decay from vaccine and infection derived neutralizing antibody titre (NAT). To use this feature, set up the model in the same way as outline in the “Natural Immunity” vignette with the following changes:</p>
<ol style="list-style-type: decimal">
<li>After all parameters have been made, use <code>make_independent_vaccine_infection_nat_parameters</code> and assign the output to the same <code>parameters</code> object, e.g. <code>parameters &lt;- make_independent_vaccine_infection_nat_parameters(parameters, ...)</code>. It takes several arguments, <code>dr_vec_doses</code> will be a matrix where each column corresponds to a dose, and rows are days. The <code>[i,j]</code>-th element then corresponds to the decay rate on the <code>i</code>-th day since receiving dose <code>j</code>. <code>dr_vec_inf</code> is a vector giving daily decay for infection derived NAT, and <code>max_ab_inf</code> is the maximum value allowed for infection-derived NAT (on natural log scale).</li>
<li>After all variables have been made, call <code>create_independent_nat_variables</code> and assign the output to the same <code>variables</code> object, e.g. <code>variables &lt;- create_independent_nat_variables(variables = variables, parameters = parameters)</code>. This adds a new <code>DoubleVariable</code> object that stores the NAT derived from infection separately.</li>
<li>Instead of using <code>attach_event_listeners_natural_immunity</code>, please use <code>attach_event_listeners_independent_nat</code>. This makes sure that upon recovery from an infection bout, a person’s infection-derived NAT boost is added to the variable specifically for infection-derived NAT values.</li>
<li>Instead of using <code>natural_immunity_ab_titre_process</code>, please use <code>independent_ab_titre_process</code>. This calculates decay for the two NAT types properly using their specific parameters.</li>
</ol>
<p>I have listed the specific functions, variables, and parameters that were modified to incorporate this feature in this <a href="https://github.com/mrc-ide/safir/issues/64" class="external-link">GitHub issue</a>.</p>
<p>This feature will not conflict with the other versions of the model (i.e. it is backwards compatible). All previous vignettes and examples should still run the way one would expect. If you find a bug or strange behavior, please make a <a href="https://github.com/mrc-ide/safir/issues" class="external-link">GitHub issue</a>, and also be sure to check that the two decay parameters and NAT boosts (<code>mu_ab_infection</code> in function <code>make_immune_parameters</code> and <code>mu_ab_list</code> in <code>get_vaccine_ab_titre_parameters</code>) are designed such that adding together the two NAT values prior to calculating efficacy makes sense.</p>
</div>
<div class="section level2">
<h2 id="time-varying-parameters">Time varying parameters<a class="anchor" aria-label="anchor" href="#time-varying-parameters"></a>
</h2>
<p>In addition to allowing time varying reproductive numbers via average contact rates, <strong>safir</strong> also supports time varying probabilities of hospitalization, severe disease, and disease outcomes, to support modeling of healthcare changes and variants.</p>
<p>By default <strong>safir</strong> uses the following parameters from <strong>squire</strong>, and all of them are vectors where each element gives the relevant probability for each age group. By default <strong>safir</strong> also uses these vectors, but it also accepts each parameter as a matrix as well. In this case, the rows correspond to age groups and the columns correspond to days (not time steps).</p>
<ol style="list-style-type: decimal">
<li>
<code>parameters$prob_hosp</code>: P(severe disease | exposure); this probability governs the chance that the exposed person will require hospitalization.</li>
<li>
<code>parameters$prob_asymp</code>: P(asymptomatic | mild disease); if the exposed person does not need hospitalization, this probability gives the chance they will be asymptomatic versus mildly symptomatic.</li>
<li>
<code>parameters$prob_severe</code> P(require ICU | hospitalized); if in hospital, does this person require an ICU bed (i.e. mechanical ventilation)?</li>
<li>
<code>parameters$prob_severe_death_treatment</code> P(death | require ICU, gets bed); if this person gets an ICU bed, will they die?</li>
<li>
<code>parameters$prob_severe_death_no_treatment</code> P(death | require ICU, don’t get bed); if this person doesn’t get an ICU bed, will they die?</li>
<li>
<code>parameters$prob_non_severe_death_treatment</code> P(death | require hosp, get bed); if in hospital but does not require ICU bed, will this person die?</li>
<li>
<code>parameters$prob_non_severe_death_no_treatment</code> P(death | require hosp, don’t get bed); if needs a hospital (but not ICU bed) but does not recieve one, will this person die?</li>
</ol>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Sean L. Wu, OJ Watson, Peter Winskill.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.1.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
